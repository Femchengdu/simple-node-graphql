(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{19:function(t,e,n){},21:function(t,e,n){t.exports=n(70)},26:function(t,e,n){},28:function(t,e,n){},30:function(t,e,n){},32:function(t,e,n){},34:function(t,e,n){},36:function(t,e,n){},38:function(t,e,n){},45:function(t,e,n){},47:function(t,e,n){},49:function(t,e,n){},51:function(t,e,n){},53:function(t,e,n){},56:function(t,e,n){},58:function(t,e,n){},60:function(t,e,n){},62:function(t,e,n){},64:function(t,e,n){},66:function(t,e,n){},68:function(t,e,n){},70:function(t,e,n){"use strict";n.r(e);var a=n(0),r=n.n(a),o=n(12),i=n.n(o),l=n(74),s=(n(26),n(5)),c=n(6),u=n(8),d=n(7),m=n(3),h=n(75),p=n(42),f=n(73),g=n(76),v=(n(28),function(t){return r.a.createElement(a.Fragment,null,r.a.createElement("header",{className:"main-header"},t.header),t.mobileNav,r.a.createElement("main",{className:"content"},t.children))}),b=(n(30),function(t){return i.a.createPortal(r.a.createElement("div",{className:["backdrop",t.open?"open":""].join(" "),onClick:t.onClick}),document.getElementById("backdrop-root"))}),y=(n(32),function(t){return r.a.createElement("div",{className:"toolbar"},t.children)}),E=n(72),w=(n(34),function(t){return r.a.createElement("button",{className:"mobile-toggle",onClick:t.onOpen},r.a.createElement("span",{className:"mobile-toggle__bar"}),r.a.createElement("span",{className:"mobile-toggle__bar"}),r.a.createElement("span",{className:"mobile-toggle__bar"}))}),S=(n(36),function(t){return r.a.createElement("h1",{className:"logo"},"MessageNode")}),j=n(17),O=(n(38),[{id:"feed",text:"Feed",link:"/",auth:!0},{id:"login",text:"Login",link:"/",auth:!1},{id:"signup",text:"Signup",link:"/signup",auth:!1}]),P=function(t){return[].concat(Object(j.a)(O.filter(function(e){return e.auth===t.isAuth}).map(function(e){return r.a.createElement("li",{key:e.id,className:["navigation-item",t.mobile?"mobile":""].join(" ")},r.a.createElement(E.a,{to:e.link,exact:!0,onClick:t.onChoose},e.text))})),[t.isAuth&&r.a.createElement("li",{className:"navigation-item",key:"logout"},r.a.createElement("button",{onClick:t.onLogout},"Logout"))])},C=(n(45),function(t){return r.a.createElement("nav",{className:"main-nav"},r.a.createElement(w,{onOpen:t.onOpenMobileNav}),r.a.createElement("div",{className:"main-nav__logo"},r.a.createElement(E.a,{to:"/"},r.a.createElement(S,null))),r.a.createElement("div",{className:"spacer"}),r.a.createElement("ul",{className:"main-nav__items"},r.a.createElement(P,{isAuth:t.isAuth,onLogout:t.onLogout})))}),F=(n(47),function(t){return r.a.createElement("nav",{className:["mobile-nav",t.open?"open":""].join(" ")},r.a.createElement("ul",{className:["mobile-nav__items",t.mobile?"mobile":""].join(" ")},r.a.createElement(P,{mobile:!0,onChoose:t.onChooseItem,isAuth:t.isAuth,onLogout:t.onLogout})))}),N=n(44),k=(n(49),function(t){return t.link?r.a.createElement(N.a,{className:["button","button--".concat(t.design),"button--".concat(t.mode)].join(" "),to:t.link},t.children):r.a.createElement("button",{className:["button","button--".concat(t.design),"button--".concat(t.mode)].join(" "),onClick:t.onClick,disabled:t.disabled||t.loading,type:t.type},t.loading?"Loading...":t.children)}),A=(n(51),function(t){return i.a.createPortal(r.a.createElement("div",{className:"modal"},r.a.createElement("header",{className:"modal__header"},r.a.createElement("h1",null,t.title)),r.a.createElement("div",{className:"modal__content"},t.children),r.a.createElement("div",{className:"modal__actions"},r.a.createElement(k,{design:"danger",mode:"flat",onClick:t.onCancelModal},"Cancel"),r.a.createElement(k,{mode:"raised",onClick:t.onAcceptModal,disabled:!t.acceptEnabled,loading:t.isLoading},"Accept"))),document.getElementById("modal-root"))}),I=function(t){return r.a.createElement(a.Fragment,null,t.error&&r.a.createElement(b,{onClick:t.onHandle}),t.error&&r.a.createElement(A,{title:"An Error Occurred",onCancelModal:t.onHandle,onAcceptModal:t.onHandle,acceptEnabled:!0},r.a.createElement("p",null,t.error.message)))},H=n(2),_=(n(53),function(t){return r.a.createElement("article",{className:"post"},r.a.createElement("header",{className:"post__header"},r.a.createElement("h3",{className:"post__meta"},"Posted by ",t.author," on ",t.date),r.a.createElement("h1",{className:"post__title"},t.title)),r.a.createElement("div",{className:"post__actions"},r.a.createElement(k,{mode:"flat",link:t.id},"View"),r.a.createElement(k,{mode:"flat",onClick:t.onStartEdit},"Edit"),r.a.createElement(k,{mode:"flat",design:"danger",onClick:t.onDelete},"Delete")))}),B=n(10),L=(n(19),function(t){return r.a.createElement("div",{className:"input"},t.label&&r.a.createElement("label",{htmlFor:t.id},t.label),"input"===t.control&&r.a.createElement("input",{className:[t.valid?"valid":"invalid",t.touched?"touched":"untouched"].join(" "),type:t.type,id:t.id,required:t.required,value:t.value,placeholder:t.placeholder,onChange:function(e){return t.onChange(t.id,e.target.value,e.target.files)},onBlur:t.onBlur}),"textarea"===t.control&&r.a.createElement("textarea",{className:[t.valid?"valid":"invalid",t.touched?"touched":"untouched"].join(" "),id:t.id,rows:t.rows,required:t.required,value:t.value,onChange:function(e){return t.onChange(t.id,e.target.value)},onBlur:t.onBlur}))}),U=function(t){return r.a.createElement("div",{className:"input"},r.a.createElement("label",{htmlFor:t.id},t.label),r.a.createElement("input",{className:[t.valid?"valid":"invalid",t.touched?"touched":"untouched"].join(" "),type:"file",id:t.id,onChange:function(e){return t.onChange(t.id,e.target.value,e.target.files)},onBlur:t.onBlur}))},x=(n(56),function(t){return r.a.createElement("div",{className:"image",style:{backgroundImage:"url('".concat(t.imageUrl,"')"),backgroundSize:t.contain?"contain":"cover",backgroundPosition:t.left?"left":"center"}})}),$=function(t){return""!==t.trim()},R=function(t){return function(e){var n=!0;return t.min&&(n=n&&e.trim().length>=t.min),t.max&&(n=n&&e.trim().length<=t.max),n}},D=function(t){return/[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?/.test(t)},T=function(t){var e=new FileReader,n=new Promise(function(t,n){e.onload=function(e){return t(e.target.result)},e.onerror=function(t){return n(t)}});return e.readAsDataURL(t),n};function q(t,e){var n;if("undefined"===typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"===typeof t)return M(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return M(t,e)}(t))||e&&t&&"number"===typeof t.length){n&&(t=n);var a=0,r=function(){};return{s:r,n:function(){return a>=t.length?{done:!0}:{done:!1,value:t[a++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,l=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return i=t.done,t},e:function(t){l=!0,o=t},f:function(){try{i||null==n.return||n.return()}finally{if(l)throw o}}}}function M(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,a=new Array(e);n<e;n++)a[n]=t[n];return a}function z(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var n,a=Object(m.a)(t);if(e){var r=Object(m.a)(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return Object(d.a)(this,n)}}var V={title:{value:"",valid:!1,touched:!1,validators:[$,R({min:5})]},image:{value:"",valid:!1,touched:!1,validators:[$]},content:{value:"",valid:!1,touched:!1,validators:[$,R({min:5})]}},J=function(t){Object(u.a)(n,t);var e=z(n);function n(){var t;Object(s.a)(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(t=e.call.apply(e,[this].concat(r))).state={postForm:V,formIsValid:!1,imagePreview:null},t.postInputChangeHandler=function(e,n,a){a&&T(a[0]).then(function(e){t.setState({imagePreview:e})}).catch(function(e){t.setState({imagePreview:null})}),t.setState(function(t){var r,o=!0,i=q(t.postForm[e].validators);try{for(i.s();!(r=i.n()).done;){var l=r.value;o=o&&l(n)}}catch(d){i.e(d)}finally{i.f()}var s=Object(H.a)({},t.postForm,Object(B.a)({},e,Object(H.a)({},t.postForm[e],{valid:o,value:a?a[0]:n}))),c=!0;for(var u in s)c=c&&s[u].valid;return{postForm:s,formIsValid:c}})},t.inputBlurHandler=function(e){t.setState(function(t){return{postForm:Object(H.a)({},t.postForm,Object(B.a)({},e,Object(H.a)({},t.postForm[e],{touched:!0})))}})},t.cancelPostChangeHandler=function(){t.setState({postForm:V,formIsValid:!1}),t.props.onCancelEdit()},t.acceptPostChangeHandler=function(){var e={title:t.state.postForm.title.value,image:t.state.postForm.image.value,content:t.state.postForm.content.value};console.log("Handlers all the way :",t.state,e),t.props.onFinishEdit(e),t.setState({postForm:V,formIsValid:!1,imagePreview:null})},t}return Object(c.a)(n,[{key:"componentDidUpdate",value:function(t,e){if(this.props.editing&&t.editing!==this.props.editing&&t.selectedPost!==this.props.selectedPost){var n={title:Object(H.a)({},e.postForm.title,{value:this.props.selectedPost.title,valid:!0}),image:Object(H.a)({},e.postForm.image,{value:this.props.selectedPost.imageUrl,valid:!0}),content:Object(H.a)({},e.postForm.content,{value:this.props.selectedPost.content,valid:!0})};this.setState({postForm:n,formIsValid:!0})}}},{key:"render",value:function(){return this.props.editing?r.a.createElement(a.Fragment,null,r.a.createElement(b,{onClick:this.cancelPostChangeHandler}),r.a.createElement(A,{title:"New Post",acceptEnabled:this.state.formIsValid,onCancelModal:this.cancelPostChangeHandler,onAcceptModal:this.acceptPostChangeHandler,isLoading:this.props.loading},r.a.createElement("form",null,r.a.createElement(L,{id:"title",label:"Title",control:"input",onChange:this.postInputChangeHandler,onBlur:this.inputBlurHandler.bind(this,"title"),valid:this.state.postForm.title.valid,touched:this.state.postForm.title.touched,value:this.state.postForm.title.value}),r.a.createElement(U,{id:"image",label:"Image",control:"input",onChange:this.postInputChangeHandler,onBlur:this.inputBlurHandler.bind(this,"image"),valid:this.state.postForm.image.valid,touched:this.state.postForm.image.touched}),r.a.createElement("div",{className:"new-post__preview-image"},!this.state.imagePreview&&r.a.createElement("p",null,"Please choose an image."),this.state.imagePreview&&r.a.createElement(x,{imageUrl:this.state.imagePreview,contain:!0,left:!0})),r.a.createElement(L,{id:"content",label:"Content",control:"textarea",rows:"5",onChange:this.postInputChangeHandler,onBlur:this.inputBlurHandler.bind(this,"content"),valid:this.state.postForm.content.valid,touched:this.state.postForm.content.touched,value:this.state.postForm.content.value})))):null}}]),n}(a.Component),Y=(n(58),function(t){return r.a.createElement("div",{className:"paginator"},t.children,r.a.createElement("div",{className:"paginator__controls"},t.currentPage>1&&r.a.createElement("button",{className:"paginator__control",onClick:t.onPrevious},"Previous"),t.currentPage<t.lastPage&&r.a.createElement("button",{className:"paginator__control",onClick:t.onNext},"Next")))}),W=(n(60),function(t){return r.a.createElement("div",{className:"loader"},r.a.createElement("div",null),r.a.createElement("div",null),r.a.createElement("div",null),r.a.createElement("div",null))});n(62);function G(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var n,a=Object(m.a)(t);if(e){var r=Object(m.a)(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return Object(d.a)(this,n)}}var K=function(t){Object(u.a)(n,t);var e=G(n);function n(){var t;Object(s.a)(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(t=e.call.apply(e,[this].concat(r))).state={isEditing:!1,posts:[],totalPosts:0,editPost:null,status:"",postPage:1,postsLoading:!0,editLoading:!1},t.loadPosts=function(e){e&&t.setState({postsLoading:!0,posts:[]});var n=t.state.postPage;"next"===e&&(n++,t.setState({postPage:n})),"previous"===e&&(n--,t.setState({postPage:n}));var a={query:"query FetchPosts($page: Int){posts(page:$page){posts{_id title content imageUrl creator{name} createdAt} totalPosts}}",variables:{page:n}};fetch("http://localhost:3090/graphql",{method:"POST",headers:{Authorization:"Bearer "+t.props.token,"Content-Type":"application/json"},body:JSON.stringify(a)}).then(function(t){return t.json()}).then(function(e){if(e.errors&&422===e.errors.status)throw new Error("Fetch post failed. something went wrong!");if(e.errors)throw new Error("Fetch post failed!");var n=e.data.posts,a=n.posts,r=n.totalPosts;t.setState({posts:a,totalPosts:r,postsLoading:!1})}).catch(t.catchError)},t.statusUpdateHandler=function(e){var n=t.state.status;e.preventDefault();var a={query:"mutation UpdateUserStatus($status: String!){\n        updateStatus(status:$status) {\n          status\n        }\n      }",variables:{status:n}};fetch("http://localhost:3090/graphql",{method:"POST",headers:{Authorization:"Bearer "+t.props.token,"Content-Type":"application/json"},body:JSON.stringify(a)}).then(function(t){return t.json()}).then(function(t){if(t.errors)throw new Error("Update status failed!");console.log(t)}).catch(t.catchError)},t.newPostHandler=function(){t.setState({isEditing:!0})},t.startEditPostHandler=function(e){t.setState(function(t){return{isEditing:!0,editPost:Object(H.a)({},t.posts.find(function(t){return t._id===e}))}})},t.cancelEditHandler=function(){t.setState({isEditing:!1,editPost:null})},t.finishEditHandler=function(e){var n=e.title,a=e.content,r=e.image;t.setState({editLoading:!0});var o=new FormData;o.append("image",r),t.state.editPost&&o.append("oldPath",t.state.editPost.imageUrl),fetch("http://localhost:3090/post-image",{method:"PUT",body:o,headers:{Authorization:"Bearer "+t.props.token}}).then(function(t){return t.json()}).then(function(e){var r=e.imageUrl,o={query:"mutation CreateNewPost($title: String!, $content: String!, $imageUrl: String!) {\n          createPost(postInput: {title: $title, content: $content, imageUrl: $imageUrl}) {\n            _id\n            title\n            content\n            imageUrl\n            creator {name}\n            createdAt\n          }\n        }",variables:{title:n,content:a,imageUrl:r}};t.state.editPost&&(o={query:"mutation UpdateExistingPost($_id: ID!, $title: String!, $content: String!, $imageUrl: String!) {\n            updatePost(id: $_id, postInput: {title: $title, content: $content, imageUrl: $imageUrl}) {\n              _id\n              title\n              content\n              imageUrl\n              creator {name}\n              createdAt\n            }\n          }",variables:{_id:t.state.editPost._id,title:n,content:a,imageUrl:r||"undefined"}});return fetch("http://localhost:3090/graphql",{method:"POST",body:JSON.stringify(o),headers:{Authorization:"Bearer "+t.props.token,"Content-Type":"application/json"}})}).then(function(t){return t.json()}).then(function(e){if(e.errors&&422===e.errors.status)throw new Error("Create post failed. something went wrong!");if(e.errors)throw new Error("Create post failed!");var n="createPost";t.state.editPost&&(n="updatePost");var a=e.data[n],r=a._id,o=a.title,i=a.content,l={_id:r,title:o,imageUrl:a.imageUrl,content:i,creator:a.creator,createdAt:a.createdAt};t.setState(function(t){var e=Object(j.a)(t.posts),n=t.totalPosts;t.editPost?e[t.posts.findIndex(function(e){return e._id===t.editPost._id})]=l:(++n>=2&&e.pop(),e.unshift(l));return{posts:e,isEditing:!1,editPost:null,editLoading:!1,totalPosts:n}})}).catch(function(e){t.setState({isEditing:!1,editPost:null,editLoading:!1,error:e})})},t.statusInputChangeHandler=function(e,n){t.setState({status:n})},t.deletePostHandler=function(e){var n={query:'mutation {\n      deletePost(id: "'.concat(e,'")\n    }')};t.setState({postsLoading:!0}),fetch("http://localhost:3090/graphql",{method:"POST",headers:{Authorization:"Bearer "+t.props.token,"Content-Type":"application/json"},body:JSON.stringify(n)}).then(function(t){return t.json()}).then(function(e){if(e.errors)throw new Error("Delete post failed!");t.loadPosts()}).catch(function(e){t.setState({postsLoading:!1})})},t.errorHandler=function(){t.setState({error:null})},t.catchError=function(e){console.log("What is this error :",e),t.setState({error:e})},t}return Object(c.a)(n,[{key:"componentDidMount",value:function(){var t=this;fetch("http://localhost:3090/graphql",{method:"POST",headers:{Authorization:"Bearer "+this.props.token,"Content-Type":"application/json"},body:JSON.stringify({query:"{user{status}}"})}).then(function(t){return t.json()}).then(function(e){var n=e.data;if(e.errors)throw new Error("Create post failed!");var a=n.user.status;console.log("The user status is :",a),t.setState({status:a})}).catch(this.catchError),this.loadPosts()}},{key:"render",value:function(){var t=this;return r.a.createElement(a.Fragment,null,r.a.createElement(I,{error:this.state.error,onHandle:this.errorHandler}),r.a.createElement(J,{editing:this.state.isEditing,selectedPost:this.state.editPost,loading:this.state.editLoading,onCancelEdit:this.cancelEditHandler,onFinishEdit:this.finishEditHandler}),r.a.createElement("section",{className:"feed__status"},r.a.createElement("form",{onSubmit:this.statusUpdateHandler},r.a.createElement(L,{type:"text",placeholder:"Your status",control:"input",onChange:this.statusInputChangeHandler,value:this.state.status}),r.a.createElement(k,{mode:"flat",type:"submit"},"Update"))),r.a.createElement("section",{className:"feed__control"},r.a.createElement(k,{mode:"raised",design:"accent",onClick:this.newPostHandler},"New Post")),r.a.createElement("section",{className:"feed"},this.state.postsLoading&&r.a.createElement("div",{style:{textAlign:"center",marginTop:"2rem"}},r.a.createElement(W,null)),this.state.posts.length<=0&&!this.state.postsLoading?r.a.createElement("p",{style:{textAlign:"center"}},"No posts found."):null,!this.state.postsLoading&&r.a.createElement(Y,{onPrevious:this.loadPosts.bind(this,"previous"),onNext:this.loadPosts.bind(this,"next"),lastPage:Math.ceil(this.state.totalPosts/2),currentPage:this.state.postPage},this.state.posts.map(function(e){return r.a.createElement(_,{key:e._id,id:e._id,author:e.creator.name,date:new Date(e.createdAt).toLocaleDateString("en-US"),title:e.title,image:e.imageUrl,content:e.content,onStartEdit:t.startEditPostHandler.bind(t,e._id),onDelete:t.deletePostHandler.bind(t,e._id)})}))))}}]),n}(a.Component);n(64);function Q(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var n,a=Object(m.a)(t);if(e){var r=Object(m.a)(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return Object(d.a)(this,n)}}var X=function(t){Object(u.a)(n,t);var e=Q(n);function n(){var t;Object(s.a)(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(t=e.call.apply(e,[this].concat(r))).state={title:"",author:"",date:"",image:"",content:""},t}return Object(c.a)(n,[{key:"componentDidMount",value:function(){var t=this,e={query:"query FetchSinglePost($postId: ID!){post(id: $postId) {title creator {name} createdAt imageUrl content}}",variables:{postId:this.props.match.params.postId}};fetch("http://localhost:3090/graphql",{method:"POST",headers:{Authorization:"Bearer "+this.props.token,"Content-Type":"application/json"},body:JSON.stringify(e)}).then(function(t){return t.json()}).then(function(e){if(console.log("component did mount :",e),e.errors&&422===e.errors.status)throw new Error("Fetch status failed. something went wrong!");if(e.errors)throw new Error("Fetch post failed!");var n=e.data.post,a=n.title,r=n.creator.name,o=n.createdAt,i=n.content,l=n.imageUrl;t.setState({title:a,author:r,date:new Date(o).toLocaleDateString("en-US"),content:i,image:"http://localhost:3090/"+l})}).catch(function(t){console.log(t)})}},{key:"render",value:function(){return r.a.createElement("section",{className:"single-post"},r.a.createElement("h1",null,this.state.title),r.a.createElement("h2",null,"Created by ",this.state.author," on ",this.state.date),r.a.createElement("div",{className:"single-post__image"},r.a.createElement(x,{contain:!0,imageUrl:this.state.image})),r.a.createElement("p",null,this.state.content))}}]),n}(a.Component),Z=(n(66),function(t){return r.a.createElement("section",{className:"auth-form"},t.children)});function tt(t,e){var n;if("undefined"===typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"===typeof t)return et(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return et(t,e)}(t))||e&&t&&"number"===typeof t.length){n&&(t=n);var a=0,r=function(){};return{s:r,n:function(){return a>=t.length?{done:!0}:{done:!1,value:t[a++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,l=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return i=t.done,t},e:function(t){l=!0,o=t},f:function(){try{i||null==n.return||n.return()}finally{if(l)throw o}}}}function et(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,a=new Array(e);n<e;n++)a[n]=t[n];return a}function nt(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var n,a=Object(m.a)(t);if(e){var r=Object(m.a)(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return Object(d.a)(this,n)}}var at=function(t){Object(u.a)(n,t);var e=nt(n);function n(){var t;Object(s.a)(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(t=e.call.apply(e,[this].concat(r))).state={loginForm:{email:{value:"",valid:!1,touched:!1,validators:[$,D]},password:{value:"",valid:!1,touched:!1,validators:[$,R({min:5})]},formIsValid:!1}},t.inputChangeHandler=function(e,n){t.setState(function(t){var a,r=!0,o=tt(t.loginForm[e].validators);try{for(o.s();!(a=o.n()).done;){var i=a.value;r=r&&i(n)}}catch(u){o.e(u)}finally{o.f()}var l=Object(H.a)({},t.loginForm,Object(B.a)({},e,Object(H.a)({},t.loginForm[e],{valid:r,value:n}))),s=!0;for(var c in l)s=s&&l[c].valid;return{loginForm:l,formIsValid:s}})},t.inputBlurHandler=function(e){t.setState(function(t){return{loginForm:Object(H.a)({},t.loginForm,Object(B.a)({},e,Object(H.a)({},t.loginForm[e],{touched:!0})))}})},t}return Object(c.a)(n,[{key:"render",value:function(){var t=this;return r.a.createElement(Z,null,r.a.createElement("form",{onSubmit:function(e){return t.props.onLogin(e,{email:t.state.loginForm.email.value,password:t.state.loginForm.password.value})}},r.a.createElement(L,{id:"email",label:"Your E-Mail",type:"email",control:"input",onChange:this.inputChangeHandler,onBlur:this.inputBlurHandler.bind(this,"email"),value:this.state.loginForm.email.value,valid:this.state.loginForm.email.valid,touched:this.state.loginForm.email.touched}),r.a.createElement(L,{id:"password",label:"Password",type:"password",control:"input",onChange:this.inputChangeHandler,onBlur:this.inputBlurHandler.bind(this,"password"),value:this.state.loginForm.password.value,valid:this.state.loginForm.password.valid,touched:this.state.loginForm.password.touched}),r.a.createElement(k,{design:"raised",type:"submit",loading:this.props.loading},"Login")))}}]),n}(a.Component);function rt(t,e){var n;if("undefined"===typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"===typeof t)return ot(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ot(t,e)}(t))||e&&t&&"number"===typeof t.length){n&&(t=n);var a=0,r=function(){};return{s:r,n:function(){return a>=t.length?{done:!0}:{done:!1,value:t[a++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,l=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return i=t.done,t},e:function(t){l=!0,o=t},f:function(){try{i||null==n.return||n.return()}finally{if(l)throw o}}}}function ot(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,a=new Array(e);n<e;n++)a[n]=t[n];return a}function it(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var n,a=Object(m.a)(t);if(e){var r=Object(m.a)(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return Object(d.a)(this,n)}}var lt=function(t){Object(u.a)(n,t);var e=it(n);function n(){var t;Object(s.a)(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(t=e.call.apply(e,[this].concat(r))).state={signupForm:{email:{value:"",valid:!1,touched:!1,validators:[$,D]},password:{value:"",valid:!1,touched:!1,validators:[$,R({min:5})]},name:{value:"",valid:!1,touched:!1,validators:[$]},formIsValid:!1}},t.inputChangeHandler=function(e,n){t.setState(function(t){var a,r=!0,o=rt(t.signupForm[e].validators);try{for(o.s();!(a=o.n()).done;){var i=a.value;r=r&&i(n)}}catch(u){o.e(u)}finally{o.f()}var l=Object(H.a)({},t.signupForm,Object(B.a)({},e,Object(H.a)({},t.signupForm[e],{valid:r,value:n}))),s=!0;for(var c in l)s=s&&l[c].valid;return{signupForm:l,formIsValid:s}})},t.inputBlurHandler=function(e){t.setState(function(t){return{signupForm:Object(H.a)({},t.signupForm,Object(B.a)({},e,Object(H.a)({},t.signupForm[e],{touched:!0})))}})},t}return Object(c.a)(n,[{key:"render",value:function(){var t=this;return r.a.createElement(Z,null,r.a.createElement("form",{onSubmit:function(e){return t.props.onSignup(e,t.state)}},r.a.createElement(L,{id:"email",label:"Your E-Mail",type:"email",control:"input",onChange:this.inputChangeHandler,onBlur:this.inputBlurHandler.bind(this,"email"),value:this.state.signupForm.email.value,valid:this.state.signupForm.email.valid,touched:this.state.signupForm.email.touched}),r.a.createElement(L,{id:"name",label:"Your Name",type:"text",control:"input",onChange:this.inputChangeHandler,onBlur:this.inputBlurHandler.bind(this,"name"),value:this.state.signupForm.name.value,valid:this.state.signupForm.name.valid,touched:this.state.signupForm.name.touched}),r.a.createElement(L,{id:"password",label:"Password",type:"password",control:"input",onChange:this.inputChangeHandler,onBlur:this.inputBlurHandler.bind(this,"password"),value:this.state.signupForm.password.value,valid:this.state.signupForm.password.valid,touched:this.state.signupForm.password.touched}),r.a.createElement(k,{design:"raised",type:"submit",loading:this.props.loading},"Signup")))}}]),n}(a.Component);n(68);function st(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var n,a=Object(m.a)(t);if(e){var r=Object(m.a)(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return Object(d.a)(this,n)}}var ct=function(t){Object(u.a)(n,t);var e=st(n);function n(){var t;Object(s.a)(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(t=e.call.apply(e,[this].concat(r))).state={showBackdrop:!1,showMobileNav:!1,isAuth:!1,token:null,userId:null,authLoading:!1,error:null},t.mobileNavHandler=function(e){t.setState({showMobileNav:e,showBackdrop:e})},t.backdropClickHandler=function(){t.setState({showBackdrop:!1,showMobileNav:!1,error:null})},t.logoutHandler=function(){t.setState({isAuth:!1,token:null}),localStorage.removeItem("token"),localStorage.removeItem("expiryDate"),localStorage.removeItem("userId")},t.loginHandler=function(e,n){e.preventDefault(),t.setState({authLoading:!0});var a={query:"query UserLogin($email: String!, $password: String!){\n        login(email:$email, password:$password) {\n          token\n          userId\n        }\n      }",variables:{email:n.email,password:n.password}};fetch("http://localhost:3090/graphql",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}).then(function(t){return t.json()}).then(function(e){if(e.errors&&422===e.errors.status)throw new Error("Login failed. Make sure you use the right email and password!");if(e.errors)throw new Error("User login failed!");console.log(e);var n=e.data.login,a=n.token,r=n.userId;t.setState({isAuth:!0,token:a,authLoading:!1,userId:r}),localStorage.setItem("token",a),localStorage.setItem("userId",r);var o=new Date((new Date).getTime()+36e5);localStorage.setItem("expiryDate",o.toISOString()),t.setAutoLogout(36e5)}).catch(function(e){console.log(e),t.setState({isAuth:!1,authLoading:!1,error:e})})},t.signupHandler=function(e,n){e.preventDefault(),t.setState({authLoading:!0});var a=n.signupForm,r=a.email,o=a.password,i=a.name,l={query:"\n        mutation SignupNewUser($email: String!, $password: String!, $name: String!){\n          createUser(userInput: {email: $email, password: $password, name: $name }){\n            _id\n            email\n          }\n        }\n      ",variables:{email:r.value,password:o.value,name:i.value}};fetch("http://localhost:3090/graphql",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)}).then(function(t){return t.json()}).then(function(e){if(e.errors&&422===e.errors.status)throw new Error("Validation failed. Make sure the email address isn't used yet!");if(e.errors)throw new Error("User creation errors!");t.setState({isAuth:!1,authLoading:!1}),t.props.history.replace("/")}).catch(function(e){console.log(e),t.setState({isAuth:!1,authLoading:!1,error:e})})},t.setAutoLogout=function(e){setTimeout(function(){t.logoutHandler()},e)},t.errorHandler=function(){t.setState({error:null})},t}return Object(c.a)(n,[{key:"componentDidMount",value:function(){var t=localStorage.getItem("token"),e=localStorage.getItem("expiryDate");if(t&&e)if(new Date(e)<=new Date)this.logoutHandler();else{var n=localStorage.getItem("userId"),a=new Date(e).getTime()-(new Date).getTime();this.setState({isAuth:!0,token:t,userId:n}),this.setAutoLogout(a)}}},{key:"render",value:function(){var t=this,e=r.a.createElement(h.a,null,r.a.createElement(p.a,{path:"/",exact:!0,render:function(e){return r.a.createElement(at,Object.assign({},e,{onLogin:t.loginHandler,loading:t.state.authLoading}))}}),r.a.createElement(p.a,{path:"/signup",exact:!0,render:function(e){return r.a.createElement(lt,Object.assign({},e,{onSignup:t.signupHandler,loading:t.state.authLoading}))}}),r.a.createElement(f.a,{to:"/"}));return this.state.isAuth&&(e=r.a.createElement(h.a,null,r.a.createElement(p.a,{path:"/",exact:!0,render:function(e){return r.a.createElement(K,{userId:t.state.userId,token:t.state.token})}}),r.a.createElement(p.a,{path:"/:postId",render:function(e){return r.a.createElement(X,Object.assign({},e,{userId:t.state.userId,token:t.state.token}))}}),r.a.createElement(f.a,{to:"/"}))),r.a.createElement(a.Fragment,null,this.state.showBackdrop&&r.a.createElement(b,{onClick:this.backdropClickHandler}),r.a.createElement(I,{error:this.state.error,onHandle:this.errorHandler}),r.a.createElement(v,{header:r.a.createElement(y,null,r.a.createElement(C,{onOpenMobileNav:this.mobileNavHandler.bind(this,!0),onLogout:this.logoutHandler,isAuth:this.state.isAuth})),mobileNav:r.a.createElement(F,{open:this.state.showMobileNav,mobile:!0,onChooseItem:this.mobileNavHandler.bind(this,!1),onLogout:this.logoutHandler,isAuth:this.state.isAuth})}),e)}}]),n}(a.Component),ut=Object(g.a)(ct);i.a.render(r.a.createElement(l.a,null,r.a.createElement(ut,null)),document.getElementById("root"))}},[[21,2,1]]]);
//# sourceMappingURL=main.f0021eac.chunk.js.map